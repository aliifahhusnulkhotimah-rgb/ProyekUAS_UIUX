<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin | Kopi Kita</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .navbar-brown { background-color: #4e342e; }
        .sidebar-dark-custom { background-color: #2c1b18 !important; }
        .brand-link-custom { background-color: #1e1210 !important; border-bottom: 1px solid #4e342e !important; }
        .nav-sidebar .nav-link.active { background-color: #fb923c !important; color: white !important; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .badge-area { font-size: 0.8rem; padding: 5px 10px; border-radius: 20px; }
    </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    <nav class="main-header navbar navbar-expand navbar-dark navbar-brown">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link text-white mr-3" href="index.html">
                    <i class="fas fa-home"></i> Lihat Website
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-danger" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </li>
        </ul>
    </nav>

    <aside class="main-sidebar sidebar-dark-primary sidebar-dark-custom elevation-4">
        <a href="#" class="brand-link brand-link-custom text-center">
            <span class="brand-text font-weight-light"><b>Kopi Kita</b> Admin</span>
        </a>

        <div class="sidebar">
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu">
                    <li class="nav-header">MENU UTAMA</li>
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="switchTab('tab-reservasi', this)">
                            <i class="nav-icon fas fa-calendar-check"></i>
                            <p>Data Reservasi</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="switchTab('tab-user', this)">
                            <i class="nav-icon fas fa-users"></i>
                            <p>Manajemen User</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="tambah.html" class="nav-link">
                            <i class="nav-icon fas fa-plus-circle"></i>
                            <p>Tambah Reservasi</p>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>

    <div class="content-wrapper">
        
        <div id="tab-reservasi" class="content-section active">
            <section class="content-header">
                <div class="container-fluid"><h1>Dashboard Reservasi</h1></div>
            </section>
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-info">
                                <div class="inner"><h3 id="res-total">0</h3><p>Total Reservasi</p></div>
                                <div class="icon"><i class="fas fa-list"></i></div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-success">
                                <div class="inner"><h3 id="res-today">0</h3><p>Hari Ini</p></div>
                                <div class="icon"><i class="fas fa-calendar-day"></i></div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm">
                        <div class="card-header border-transparent bg-white">
                            <h3 class="card-title font-weight-bold">Daftar Reservasi Pelanggan</h3>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table m-0 table-hover">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>No</th>
                                            <th>Nama</th>
                                            <th>WhatsApp</th>
                                            <th>Tanggal</th>
                                            <th>Waktu</th>
                                            <th>Orang</th>
                                            <th>Area / Request</th> <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="res-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id="tab-user" class="content-section">
            <section class="content-header">
                <div class="container-fluid"><h1>Manajemen User</h1></div>
            </section>
            <section class="content">
                <div class="container-fluid">
                    <div class="card shadow-sm">
                        <div class="card-header border-transparent bg-white">
                            <h3 class="card-title font-weight-bold">Daftar Akun Terdaftar</h3>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table m-0 table-hover">
                                    <thead class="thead-light">
                                        <tr>
                                            <th style="width: 50px">No</th>
                                            <th>Nama Pengguna</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="user-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer clearfix bg-white">
                            <span id="userCountLabel" class="text-muted small">Total: 0 User</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

    </div>

    <footer class="main-footer text-center">
        <strong>&copy; 2024 <a href="#" class="text-brown">Kopi Kita</a>.</strong> All rights reserved.
    </footer>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

<script>
// --- KONFIGURASI NAVIGASI TAB ---
function switchTab(tabId, element) {
    $('.content-section').removeClass('active');
    $('#' + tabId).addClass('active');
    $('.nav-link').removeClass('active');
    $(element).addClass('active');
}

// --- FUNGSI MANAJEMEN USER ---
function loadUsers() {
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const activeUser = localStorage.getItem("activeUser");
    const table = document.getElementById("user-table-body");
    const countLabel = document.getElementById("userCountLabel");
    
    table.innerHTML = "";
    if (users.length === 0) {
        table.innerHTML = `<tr><td colspan="5" class="text-center text-muted py-4">Belum ada user terdaftar</td></tr>`;
    } else {
        users.forEach((user, index) => {
            const isOnline = user.email === activeUser;
            table.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${user.nama}</td>
                    <td>${user.email}</td>
                    <td><span class="badge ${isOnline ? 'badge-success' : 'badge-secondary'}">${isOnline ? 'Online' : 'Offline'}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
        });
    }
    countLabel.innerText = `Total: ${users.length} User`;
}

function deleteUser(index) {
    if (confirm("Hapus user ini?")) {
        let users = JSON.parse(localStorage.getItem("users")) || [];
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        loadUsers();
    }
}

// --- FUNGSI MANAJEMEN RESERVASI ---
function loadReservasi() {
    const reservasi = JSON.parse(localStorage.getItem("reservations")) || [];
    const tableBody = document.getElementById("res-table-body");
    const totalLabel = document.getElementById("res-total");
    const todayLabel = document.getElementById("res-today");

    tableBody.innerHTML = "";
    let todayCount = 0;
    const todayDate = new Date().toISOString().split('T')[0];

    if (reservasi.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="8" class="text-center py-4">Belum ada reservasi masuk</td></tr>`;
    } else {
        reservasi.forEach((res, index) => {
            if(res.tanggal === todayDate) todayCount++;
            
            // Penentuan warna badge area
            let areaClass = 'badge-warning';
            if(res.area === 'VIP Room') areaClass = 'badge-danger';
            if(res.area === 'Outdoor (Smoking)') areaClass = 'badge-success';

            tableBody.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td class="font-weight-bold">${res.nama}</td>
                    <td><a href="https://wa.me/${res.whatsapp}" target="_blank" class="text-success"><i class="fab fa-whatsapp"></i> ${res.whatsapp}</a></td>
                    <td>${res.tanggal}</td>
                    <td><span class="badge badge-light border">${res.waktu}</span></td>
                    <td>${res.jumlah}</td>
                    <td><span class="badge ${areaClass} badge-area">${res.area || 'Indoor'}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteReservasi(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
        });
    }
    totalLabel.innerText = reservasi.length;
    todayLabel.innerText = todayCount;
}

function deleteReservasi(index) {
    if (confirm("Hapus data reservasi ini?")) {
        let reservasi = JSON.parse(localStorage.getItem("reservations")) || [];
        reservasi.splice(index, 1);
        localStorage.setItem("reservations", JSON.stringify(reservasi));
        loadReservasi();
    }
}

// --- SISTEM LOGOUT & SECURITY ---
function logout() {
    if (confirm('Yakin ingin keluar dari panel admin?')) {
        localStorage.removeItem('isAdminLoggedIn');
        window.location.href = 'login-admin.html';
    }
}

// Proteksi Halaman
if (!localStorage.getItem('isAdminLoggedIn')) {
    window.location.href = 'login-admin.html';
}

// Auto Load
document.addEventListener("DOMContentLoaded", () => {
    loadUsers();
    loadReservasi();
});
</script>

</body>
</html>